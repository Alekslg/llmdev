
<!doctype html>
<html lang="ru" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Перевод GPT">
      
      
        <link rel="canonical" href="https://llmdev.ru/tutorials/chatbot/">
      
      
        <link rel="prev" href="../llm-chain/">
      
      
        <link rel="next" href="../agents/">
      
      
      <link rel="icon" href="../../assets/images/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.19">
    
    
      
        <title>Build a Chatbot - LangChain Russian Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/css/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#-" class="md-skip">
          Перейти к содержанию
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Верхний колонтитул">
    <a href="../.." title="LangChain Russian Docs" class="md-header__button md-logo" aria-label="LangChain Russian Docs" data-md-component="logo">
      
  <img src="../../assets/images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LangChain Russian Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Build a Chatbot
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to Book Mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to Book Mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm0 2h7v5h5v11H6zm2 8v2h8v-2zm0 4v2h5v-2z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="book" data-md-color-primary="teal" data-md-color-accent="teal"  aria-label="Switch to Docs Mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to Docs Mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5zM6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Поиск" placeholder="Поиск" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Поиск">
        
        <button type="reset" class="md-search__icon md-icon" title="Очистить" aria-label="Очистить" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Инициализация поиска
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Навигация" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="LangChain Russian Docs" class="md-nav__button md-logo" aria-label="LangChain Russian Docs" data-md-component="logo">
      
  <img src="../../assets/images/logo.png" alt="logo">

    </a>
    LangChain Russian Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Главная
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Интеграции
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Интеграции
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Integrations/openai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAI
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Основы
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Основы
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basics/introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Введение
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Концепции
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Концепции
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/chat-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Чат-модели
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Обучение
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Обучение
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../llm-chain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Простое приложение LLM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Создайте чат-бота
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Создайте чат-бота
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      Обзор
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      Настройка
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Настройка">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jupyter-notebook" class="md-nav__link">
    <span class="md-ellipsis">
      Jupyter Notebook
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      Установка
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#langsmith" class="md-nav__link">
    <span class="md-ellipsis">
      LangSmith
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      Быстрый старт
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      Персистентность сообщений
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      Шаблоны промптов
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      Управление историей беседы
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      Потоковая передача
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      Следующие шаги
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Создайте агента
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pomodoro.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    🐍 Pomodoro ⏳
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      Обзор
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      Настройка
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Настройка">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jupyter-notebook" class="md-nav__link">
    <span class="md-ellipsis">
      Jupyter Notebook
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      Установка
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#langsmith" class="md-nav__link">
    <span class="md-ellipsis">
      LangSmith
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      Быстрый старт
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      Персистентность сообщений
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      Шаблоны промптов
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      Управление историей беседы
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      Потоковая передача
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      Следующие шаги
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="-">Создайте чат-бота<a class="headerlink" href="#-" title="Permanent link">&para;</a></h1>
<p>Это руководство ранее использовало абстракцию <code>RunnableWithMessageHistory</code>. Вы можете получить доступ к той версии документации в документации v0.2.</p>
<p>Начиная с выпуска LangChain v0.3, мы рекомендуем пользователям LangChain использовать персистентность LangGraph для включения <code>memory</code> (памяти) в новые приложения LangChain.</p>
<p>Если ваш код уже использует <code>RunnableWithMessageHistory</code> или <code>BaseChatMessageHistory</code>, вам <strong>не</strong> нужно вносить какие-либо изменения. Мы не планируем отказываться от этой функциональности в ближайшем будущем, поскольку она работает для простых чат-приложений, и любой код, использующий <code>RunnableWithMessageHistory</code>, будет продолжать работать как ожидалось.</p>
<p>Пожалуйста, смотрите раздел <a href="https://python.langchain.com/docs/how_to/migrate_to_langgraph_memory/">How to migrate to LangGraph Memory</a> для получения более подробной информации.</p>
<h2 id="_1">Обзор<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>Мы рассмотрим пример того, как спроектировать и реализовать чат-бота на основе LLM. Этот чат-бот сможет вести беседу и запоминать предыдущие взаимодействия с чат-моделью.</p>
<p>Обратите внимание, что этот чат-бот, который мы создадим, будет использовать языковую модель только для ведения беседы. Существует несколько других связанных концепций, которые могут вас интересовать:</p>
<ul>
<li>Conversational RAG: Включить опыт чат-бота над внешним источником данных</li>
<li>Agents: Создать чат-бота, который может выполнять действия</li>
</ul>
<p>Это руководство охватывает основы, которые будут полезны для освоения этих двух более продвинутых тем, но вы можете сразу перейти к ним, если пожелаете.</p>
<h2 id="_2">Настройка<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<h3 id="jupyter-notebook">Jupyter Notebook<a class="headerlink" href="#jupyter-notebook" title="Permanent link">&para;</a></h3>
<p>Это руководство (и большинство других руководств в документации) использует Jupyter notebooks и предполагает, что читатель также использует их. Jupyter notebooks идеально подходят для изучения работы с системами LLM, потому что часто что-то может пойти не так (неожиданный вывод, API недоступен и т.д.), и прохождение руководств в интерактивной среде — отличный способ лучше их понять.</p>
<p>Это и другие руководства, возможно, наиболее удобно запускать в Jupyter notebook. Инструкции по установке см. здесь.</p>
<h3 id="_3">Установка<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>Для этого руководства нам понадобятся <code>langchain-core</code> и <code>langgraph</code>. Это руководство требует <code>langgraph &gt;= 0.2.28</code>.</p>
<ul>
<li>Pip</li>
<li>Conda</li>
</ul>
<div class="highlight"><pre><span></span><code>pip install langchain-core langgraph&gt;0.2.27
</code></pre></div>
<div class="highlight"><pre><span></span><code>conda install langchain-core langgraph&gt;0.2.27 -c conda-forge
</code></pre></div>
<p>Для получения более подробной информации см. наше руководство по установке.</p>
<h3 id="langsmith">LangSmith<a class="headerlink" href="#langsmith" title="Permanent link">&para;</a></h3>
<p>Многие приложения, которые вы создаете с помощью LangChain, будут содержать несколько шагов с несколькими вызовами LLM. По мере того как эти приложения становятся все более и более сложными, становится крайне важно иметь возможность проверять, что именно происходит внутри вашей цепочки или агента. Лучший способ сделать это — с помощью LangSmith.</p>
<p>После регистрации по ссылке выше, <strong>(вам нужно будет создать ключ API на странице Settings -&gt; API Keys на веб-сайте LangSmith)</strong>, убедитесь, что вы установили переменные среды для начала записи трассировок:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">LANGSMITH_TRACING</span><span class="o">=</span><span class="s2">&quot;true&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">LANGSMITH_API_KEY</span><span class="o">=</span><span class="s2">&quot;...&quot;</span>
</code></pre></div>
<p>Или, если вы находитесь в ноутбуке, вы можете установить их с помощью:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">getpass</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;LANGSMITH_TRACING&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;LANGSMITH_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">()</span>
</code></pre></div>
<h2 id="_4">Быстрый старт<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>Прежде всего, давайте узнаем, как использовать языковую модель саму по себе. LangChain поддерживает множество различных языковых моделей, которые можно использовать взаимозаменяемо — выберите ту, которую хотите использовать ниже!</p>
<div class="highlight"><pre><span></span><code>pip install -qU &quot;langchain[google-genai]&quot;
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">getpass</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;GOOGLE_API_KEY&quot;</span><span class="p">):</span>
  <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;GOOGLE_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">(</span><span class="s2">&quot;Введите ключ API для Google Gemini: &quot;</span><span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.chat_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">init_chat_model</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">init_chat_model</span><span class="p">(</span><span class="s2">&quot;gemini-2.5-flash&quot;</span><span class="p">,</span> <span class="n">model_provider</span><span class="o">=</span><span class="s2">&quot;google_genai&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Давайте сначала воспользуемся моделью напрямую. <code>ChatModel</code> являются экземплярами "Runnables" LangChain, что означает, что они предоставляют стандартный интерфейс для взаимодействия с ними. Чтобы просто вызвать модель, мы можем передать список сообщений методу <code>.invoke</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.messages</span><span class="w"> </span><span class="kn">import</span> <span class="n">HumanMessage</span>

<span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">([</span><span class="n">HumanMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;Hi! I&#39;m Bob&quot;</span><span class="p">)])</span>
</code></pre></div>
<p><strong>Справочник по API:</strong> <a href="https://api.python.langchain.com/en/latest/messages/langchain_core.messages.HumanMessage.html">HumanMessage</a></p>
<div class="highlight"><pre><span></span><code><span class="n">AIMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s1">&#39;Hi Bob! How can I assist you today?&#39;</span><span class="p">,</span> <span class="n">additional_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;refusal&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span> <span class="n">response_metadata</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;token_usage&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;completion_tokens&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;prompt_tokens&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;total_tokens&#39;</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span> <span class="s1">&#39;completion_tokens_details&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;accepted_prediction_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;audio_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;reasoning_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rejected_prediction_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="s1">&#39;prompt_tokens_details&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;audio_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;cached_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}},</span> <span class="s1">&#39;model_name&#39;</span><span class="p">:</span> <span class="s1">&#39;gpt-4o-mini-2024-07-18&#39;</span><span class="p">,</span> <span class="s1">&#39;system_fingerprint&#39;</span><span class="p">:</span> <span class="s1">&#39;fp_0705bf87c0&#39;</span><span class="p">,</span> <span class="s1">&#39;finish_reason&#39;</span><span class="p">:</span> <span class="s1">&#39;stop&#39;</span><span class="p">,</span> <span class="s1">&#39;logprobs&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;run-5211544f-da9f-4325-8b8e-b3d92b2fc71a-0&#39;</span><span class="p">,</span> <span class="n">usage_metadata</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;input_tokens&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;output_tokens&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;total_tokens&#39;</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span> <span class="s1">&#39;input_token_details&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;audio&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;cache_read&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="s1">&#39;output_token_details&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;audio&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;reasoning&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}})</span>
</code></pre></div>
<p>Модель сама по себе не имеет никакого понятия о состоянии. Например, если вы зададите последующий вопрос:</p>
<div class="highlight"><pre><span></span><code><span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">([</span><span class="n">HumanMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;What&#39;s my name?&quot;</span><span class="p">)])</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">AIMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;I&#39;m sorry, but I don&#39;t have access to personal information about users unless it has been shared with me in the course of our conversation. How can I assist you today?&quot;</span><span class="p">,</span> <span class="n">additional_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;refusal&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span> <span class="n">response_metadata</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;token_usage&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;completion_tokens&#39;</span><span class="p">:</span> <span class="mi">34</span><span class="p">,</span> <span class="s1">&#39;prompt_tokens&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;total_tokens&#39;</span><span class="p">:</span> <span class="mi">45</span><span class="p">,</span> <span class="s1">&#39;completion_tokens_details&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;accepted_prediction_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;audio_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;reasoning_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rejected_prediction_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="s1">&#39;prompt_tokens_details&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;audio_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;cached_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}},</span> <span class="s1">&#39;model_name&#39;</span><span class="p">:</span> <span class="s1">&#39;gpt-4o-mini-2024-07-18&#39;</span><span class="p">,</span> <span class="s1">&#39;system_fingerprint&#39;</span><span class="p">:</span> <span class="s1">&#39;fp_0705bf87c0&#39;</span><span class="p">,</span> <span class="s1">&#39;finish_reason&#39;</span><span class="p">:</span> <span class="s1">&#39;stop&#39;</span><span class="p">,</span> <span class="s1">&#39;logprobs&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;run-a2d13a18-7022-4784-b54f-f85c097d1075-0&#39;</span><span class="p">,</span> <span class="n">usage_metadata</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;input_tokens&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;output_tokens&#39;</span><span class="p">:</span> <span class="mi">34</span><span class="p">,</span> <span class="s1">&#39;total_tokens&#39;</span><span class="p">:</span> <span class="mi">45</span><span class="p">,</span> <span class="s1">&#39;input_token_details&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;audio&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;cache_read&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="s1">&#39;output_token_details&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;audio&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;reasoning&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}})</span>
</code></pre></div>
<p>Давайте посмотрим на пример трассировки LangSmith.</p>
<p>Мы видим, что модель не учитывает предыдущий ход беседы и не может ответить на вопрос. Это создает ужасный опыт чат-бота!</p>
<p>Чтобы обойти это, нам нужно передать всю историю беседы в модель. Посмотрим, что произойдет, когда мы это сделаем:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.messages</span><span class="w"> </span><span class="kn">import</span> <span class="n">AIMessage</span>

<span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">HumanMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;Hi! I&#39;m Bob&quot;</span><span class="p">),</span>
        <span class="n">AIMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;Hello Bob! How can I assist you today?&quot;</span><span class="p">),</span>
        <span class="n">HumanMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;What&#39;s my name?&quot;</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
</code></pre></div>
<p><strong>Справочник по API:</strong> <a href="https://api.python.langchain.com/en/latest/messages/langchain_core.messages.AIMessage.html">AIMessage</a></p>
<div class="highlight"><pre><span></span><code><span class="n">AIMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s1">&#39;Your name is Bob! How can I help you today, Bob?&#39;</span><span class="p">,</span> <span class="n">additional_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;refusal&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span> <span class="n">response_metadata</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;token_usage&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;completion_tokens&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s1">&#39;prompt_tokens&#39;</span><span class="p">:</span> <span class="mi">33</span><span class="p">,</span> <span class="s1">&#39;total_tokens&#39;</span><span class="p">:</span> <span class="mi">47</span><span class="p">,</span> <span class="s1">&#39;completion_tokens_details&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;accepted_prediction_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;audio_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;reasoning_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rejected_prediction_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="s1">&#39;prompt_tokens_details&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;audio_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;cached_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}},</span> <span class="s1">&#39;model_name&#39;</span><span class="p">:</span> <span class="s1">&#39;gpt-4o-mini-2024-07-18&#39;</span><span class="p">,</span> <span class="s1">&#39;system_fingerprint&#39;</span><span class="p">:</span> <span class="s1">&#39;fp_0705bf87c0&#39;</span><span class="p">,</span> <span class="s1">&#39;finish_reason&#39;</span><span class="p">:</span> <span class="s1">&#39;stop&#39;</span><span class="p">,</span> <span class="s1">&#39;logprobs&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;run-34bcccb3-446e-42f2-b1de-52c09936c02c-0&#39;</span><span class="p">,</span> <span class="n">usage_metadata</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;input_tokens&#39;</span><span class="p">:</span> <span class="mi">33</span><span class="p">,</span> <span class="s1">&#39;output_tokens&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s1">&#39;total_tokens&#39;</span><span class="p">:</span> <span class="mi">47</span><span class="p">,</span> <span class="s1">&#39;input_token_details&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;audio&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;cache_read&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="s1">&#39;output_token_details&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;audio&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;reasoning&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}})</span>
</code></pre></div>
<p>И теперь мы видим, что получаем хороший ответ!</p>
<p>Это основная идея, лежащая в основе способности чат-бота вести беседу. Так как же нам лучше всего это реализовать?</p>
<h2 id="_5">Персистентность сообщений<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<p>LangGraph реализует встроенный слой персистентности, что делает его идеальным для чат-приложений, поддерживающих несколько ходов беседы.</p>
<p>Обертывание нашей чат-модели в минимальное приложение LangGraph позволяет нам автоматически сохранять историю сообщений, упрощая разработку приложений с несколькими ходами.</p>
<p>LangGraph поставляется с простым чекпоинтером в памяти, который мы используем ниже. См. его документацию для получения более подробной информации, включая использование различных бэкендов персистентности (например, SQLite или Postgres).</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.checkpoint.memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">MemorySaver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">START</span><span class="p">,</span> <span class="n">MessagesState</span><span class="p">,</span> <span class="n">StateGraph</span>

<span class="c1"># Определите новый граф</span>
<span class="n">workflow</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">state_schema</span><span class="o">=</span><span class="n">MessagesState</span><span class="p">)</span>


<span class="c1"># Определите функцию, которая вызывает модель</span>
<span class="k">def</span><span class="w"> </span><span class="nf">call_model</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">MessagesState</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">response</span><span class="p">}</span>


<span class="c1"># Определите (единственный) узел в графе</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">)</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">call_model</span><span class="p">)</span>

<span class="c1"># Добавьте память</span>
<span class="n">memory</span> <span class="o">=</span> <span class="n">MemorySaver</span><span class="p">()</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">checkpointer</span><span class="o">=</span><span class="n">memory</span><span class="p">)</span>
</code></pre></div>
<p>Теперь нам нужно создать <code>config</code>, который мы передаем в runnable каждый раз. Этот config содержит информацию, которая не является частью входных данных напрямую, но все же полезна. В данном случае мы хотим включить <code>thread_id</code>. Это должно выглядеть так:</p>
<div class="highlight"><pre><span></span><code><span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;configurable&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;thread_id&quot;</span><span class="p">:</span> <span class="s2">&quot;abc123&quot;</span><span class="p">}}</span>
</code></pre></div>
<p>Это позволяет нам поддерживать несколько потоков беседы с одним приложением, что является распространенным требованием, когда у вашего приложения есть несколько пользователей.</p>
<p>Затем мы можем вызвать приложение:</p>
<div class="highlight"><pre><span></span><code><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;Hi! I&#39;m Bob.&quot;</span>

<span class="n">input_messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">HumanMessage</span><span class="p">(</span><span class="n">query</span><span class="p">)]</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">input_messages</span><span class="p">},</span> <span class="n">config</span><span class="p">)</span>
<span class="n">output</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>  <span class="c1"># output содержит все сообщения в состоянии</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">==================================</span><span class="p">[</span><span class="mi">1</span><span class="n">m</span> <span class="n">Ai</span> <span class="n">Message</span> <span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="o">==================================</span>

<span class="n">Hi</span> <span class="n">Bob</span><span class="err">!</span> <span class="n">How</span> <span class="n">can</span> <span class="n">I</span> <span class="n">assist</span> <span class="n">you</span> <span class="n">today</span><span class="err">?</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;What&#39;s my name?&quot;</span>

<span class="n">input_messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">HumanMessage</span><span class="p">(</span><span class="n">query</span><span class="p">)]</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">input_messages</span><span class="p">},</span> <span class="n">config</span><span class="p">)</span>
<span class="n">output</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">==================================</span><span class="p">[</span><span class="mi">1</span><span class="n">m</span> <span class="n">Ai</span> <span class="n">Message</span> <span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="o">==================================</span>

<span class="n">Your</span> <span class="n">name</span> <span class="ow">is</span> <span class="n">Bob</span><span class="err">!</span> <span class="n">How</span> <span class="n">can</span> <span class="n">I</span> <span class="n">help</span> <span class="n">you</span> <span class="n">today</span><span class="p">,</span> <span class="n">Bob</span><span class="err">?</span>
</code></pre></div>
<p>Отлично! Наш чат-бот теперь помнит о нас. Если мы изменим config, чтобы сослаться на другой <code>thread_id</code>, мы увидим, что он начинает беседу заново.</p>
<div class="highlight"><pre><span></span><code><span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;configurable&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;thread_id&quot;</span><span class="p">:</span> <span class="s2">&quot;abc234&quot;</span><span class="p">}}</span>

<span class="n">input_messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">HumanMessage</span><span class="p">(</span><span class="n">query</span><span class="p">)]</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">input_messages</span><span class="p">},</span> <span class="n">config</span><span class="p">)</span>
<span class="n">output</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">==================================</span><span class="p">[</span><span class="mi">1</span><span class="n">m</span> <span class="n">Ai</span> <span class="n">Message</span> <span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="o">==================================</span>

<span class="n">I</span><span class="s1">&#39;m sorry, but I don&#39;</span><span class="n">t</span> <span class="n">have</span> <span class="n">access</span> <span class="n">to</span> <span class="n">personal</span> <span class="n">information</span> <span class="n">about</span> <span class="n">you</span> <span class="n">unless</span> <span class="n">you</span><span class="s1">&#39;ve shared it in this conversation. How can I assist you today?</span>
</code></pre></div>
<p>Однако мы всегда можем вернуться к исходной беседе (поскольку мы сохраняем ее в базе данных).</p>
<div class="highlight"><pre><span></span><code><span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;configurable&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;thread_id&quot;</span><span class="p">:</span> <span class="s2">&quot;abc123&quot;</span><span class="p">}}</span>

<span class="n">input_messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">HumanMessage</span><span class="p">(</span><span class="n">query</span><span class="p">)]</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">input_messages</span><span class="p">},</span> <span class="n">config</span><span class="p">)</span>
<span class="n">output</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">==================================</span><span class="p">[</span><span class="mi">1</span><span class="n">m</span> <span class="n">Ai</span> <span class="n">Message</span> <span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="o">==================================</span>

<span class="n">Your</span> <span class="n">name</span> <span class="ow">is</span> <span class="n">Bob</span><span class="o">.</span> <span class="n">What</span> <span class="n">would</span> <span class="n">you</span> <span class="n">like</span> <span class="n">to</span> <span class="n">discuss</span> <span class="n">today</span><span class="err">?</span>
</code></pre></div>
<p>Вот как мы можем поддерживать чат-бота, ведущего беседы со многими пользователями!</p>
<p>Для асинхронной поддержки обновите узел <code>call_model</code>, чтобы он был асинхронной функцией, и используйте <code>.ainvoke</code> при вызове приложения:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Асинхронная функция для узла:</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">call_model</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">MessagesState</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">model</span><span class="o">.</span><span class="n">ainvoke</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">response</span><span class="p">}</span>


<span class="c1"># Определите граф как раньше:</span>
<span class="n">workflow</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">state_schema</span><span class="o">=</span><span class="n">MessagesState</span><span class="p">)</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">)</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">call_model</span><span class="p">)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">checkpointer</span><span class="o">=</span><span class="n">MemorySaver</span><span class="p">())</span>

<span class="c1"># Асинхронный вызов:</span>
<span class="n">output</span> <span class="o">=</span> <span class="k">await</span> <span class="n">app</span><span class="o">.</span><span class="n">ainvoke</span><span class="p">({</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">input_messages</span><span class="p">},</span> <span class="n">config</span><span class="p">)</span>
<span class="n">output</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>
</code></pre></div>
<p>На данный момент все, что мы сделали, — это добавили простой слой персистентности вокруг модели. Мы можем начать усложнять и персонализировать чат-бота, добавив шаблон промпта.</p>
<h2 id="_6">Шаблоны промптов<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<p>Шаблоны промптов (Prompt Templates) помогают преобразовать необработанную пользовательскую информацию в формат, с которым может работать LLM. В данном случае необработанный пользовательский ввод — это просто сообщение, которое мы передаем LLM. Теперь давайте сделаем это немного сложнее. Во-первых, добавим системное сообщение с некоторыми пользовательскими инструкциями (но по-прежнему принимающее сообщения в качестве входных данных). Затем добавим больше входных данных, кроме самих сообщений.</p>
<p>Чтобы добавить системное сообщение, мы создадим <code>ChatPromptTemplate</code>. Мы будем использовать <code>MessagesPlaceholder</code>, чтобы передать все сообщения.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.prompts</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChatPromptTemplate</span><span class="p">,</span> <span class="n">MessagesPlaceholder</span>

<span class="n">prompt_template</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_messages</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">(</span>
            <span class="s2">&quot;system&quot;</span><span class="p">,</span>
            <span class="s2">&quot;You talk like a pirate. Answer all questions to the best of your ability.&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">MessagesPlaceholder</span><span class="p">(</span><span class="n">variable_name</span><span class="o">=</span><span class="s2">&quot;messages&quot;</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
</code></pre></div>
<p>Теперь мы можем обновить наше приложение, чтобы включить этот шаблон:</p>
<div class="highlight"><pre><span></span><code><span class="n">workflow</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">state_schema</span><span class="o">=</span><span class="n">MessagesState</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">call_model</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">MessagesState</span><span class="p">):</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="n">prompt_template</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">response</span><span class="p">}</span>


<span class="n">workflow</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">)</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">call_model</span><span class="p">)</span>

<span class="n">memory</span> <span class="o">=</span> <span class="n">MemorySaver</span><span class="p">()</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">checkpointer</span><span class="o">=</span><span class="n">memory</span><span class="p">)</span>
</code></pre></div>
<p>Мы вызываем приложение тем же способом:</p>
<div class="highlight"><pre><span></span><code><span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;configurable&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;thread_id&quot;</span><span class="p">:</span> <span class="s2">&quot;abc345&quot;</span><span class="p">}}</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;Hi! I&#39;m Jim.&quot;</span>

<span class="n">input_messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">HumanMessage</span><span class="p">(</span><span class="n">query</span><span class="p">)]</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">input_messages</span><span class="p">},</span> <span class="n">config</span><span class="p">)</span>
<span class="n">output</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">==================================</span><span class="p">[</span><span class="mi">1</span><span class="n">m</span> <span class="n">Ai</span> <span class="n">Message</span> <span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="o">==================================</span>

<span class="n">Ahoy</span> <span class="n">there</span><span class="p">,</span> <span class="n">Jim</span><span class="err">!</span> <span class="n">What</span> <span class="n">brings</span> <span class="n">ye</span> <span class="n">to</span> <span class="n">these</span> <span class="n">waters</span> <span class="n">today</span><span class="err">?</span> <span class="n">Be</span> <span class="n">ye</span> <span class="n">seekin</span><span class="s1">&#39; treasure, knowledge, or perhaps a good tale from the high seas? Arrr!</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;What is my name?&quot;</span>

<span class="n">input_messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">HumanMessage</span><span class="p">(</span><span class="n">query</span><span class="p">)]</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">input_messages</span><span class="p">},</span> <span class="n">config</span><span class="p">)</span>
<span class="n">output</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">==================================</span><span class="p">[</span><span class="mi">1</span><span class="n">m</span> <span class="n">Ai</span> <span class="n">Message</span> <span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="o">==================================</span>

<span class="n">Ye</span> <span class="n">be</span> <span class="n">called</span> <span class="n">Jim</span><span class="p">,</span> <span class="n">matey</span><span class="err">!</span> <span class="n">A</span> <span class="n">fine</span> <span class="n">name</span> <span class="n">fer</span> <span class="n">a</span> <span class="n">swashbuckler</span> <span class="n">such</span> <span class="k">as</span> <span class="n">yerself</span><span class="err">!</span> <span class="n">What</span> <span class="k">else</span> <span class="n">can</span> <span class="n">I</span> <span class="n">do</span> <span class="n">fer</span> <span class="n">ye</span><span class="err">?</span> <span class="n">Arrr</span><span class="err">!</span>
</code></pre></div>
<p>Отлично! Теперь давайте сделаем наш промпт немного сложнее. Предположим, что шаблон промпта теперь выглядит примерно так:</p>
<div class="highlight"><pre><span></span><code><span class="n">prompt_template</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_messages</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">(</span>
            <span class="s2">&quot;system&quot;</span><span class="p">,</span>
            <span class="s2">&quot;You are a helpful assistant. Answer all questions to the best of your ability in </span><span class="si">{language}</span><span class="s2">.&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">MessagesPlaceholder</span><span class="p">(</span><span class="n">variable_name</span><span class="o">=</span><span class="s2">&quot;messages&quot;</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
</code></pre></div>
<p>Обратите внимание, что мы добавили новый входной параметр <code>language</code> в промпт. Наше приложение теперь имеет два параметра — входные данные <code>messages</code> и <code>language</code>. Мы должны обновить состояние нашего приложения, чтобы отразить это:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sequence</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.messages</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseMessage</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph.message</span><span class="w"> </span><span class="kn">import</span> <span class="n">add_messages</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span><span class="p">,</span> <span class="n">TypedDict</span>


<span class="k">class</span><span class="w"> </span><span class="nc">State</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">messages</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">BaseMessage</span><span class="p">],</span> <span class="n">add_messages</span><span class="p">]</span>
    <span class="n">language</span><span class="p">:</span> <span class="nb">str</span>


<span class="n">workflow</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">state_schema</span><span class="o">=</span><span class="n">State</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">call_model</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">):</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="n">prompt_template</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">response</span><span class="p">]}</span>


<span class="n">workflow</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">)</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">call_model</span><span class="p">)</span>

<span class="n">memory</span> <span class="o">=</span> <span class="n">MemorySaver</span><span class="p">()</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">checkpointer</span><span class="o">=</span><span class="n">memory</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;configurable&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;thread_id&quot;</span><span class="p">:</span> <span class="s2">&quot;abc456&quot;</span><span class="p">}}</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;Hi! I&#39;m Bob.&quot;</span>
<span class="n">language</span> <span class="o">=</span> <span class="s2">&quot;Spanish&quot;</span>

<span class="n">input_messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">HumanMessage</span><span class="p">(</span><span class="n">query</span><span class="p">)]</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">input_messages</span><span class="p">,</span> <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">},</span>
    <span class="n">config</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">output</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">==================================</span><span class="p">[</span><span class="mi">1</span><span class="n">m</span> <span class="n">Ai</span> <span class="n">Message</span> <span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="o">==================================</span>

<span class="err">¡</span><span class="n">Hola</span><span class="p">,</span> <span class="n">Bob</span><span class="err">!</span> <span class="err">¿</span><span class="n">Cómo</span> <span class="n">puedo</span> <span class="n">ayudarte</span> <span class="n">hoy</span><span class="err">?</span>
</code></pre></div>
<p>Обратите внимание, что все состояние сохраняется, поэтому мы можем опустить параметры, такие как <code>language</code>, если не требуется вносить изменения:</p>
<div class="highlight"><pre><span></span><code><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;What is my name?&quot;</span>

<span class="n">input_messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">HumanMessage</span><span class="p">(</span><span class="n">query</span><span class="p">)]</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">input_messages</span><span class="p">},</span>
    <span class="n">config</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">output</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">==================================</span><span class="p">[</span><span class="mi">1</span><span class="n">m</span> <span class="n">Ai</span> <span class="n">Message</span> <span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="o">==================================</span>

<span class="n">Tu</span> <span class="n">nombre</span> <span class="n">es</span> <span class="n">Bob</span><span class="o">.</span> <span class="err">¿</span><span class="n">Hay</span> <span class="n">algo</span> <span class="n">más</span> <span class="n">en</span> <span class="n">lo</span> <span class="n">que</span> <span class="n">pueda</span> <span class="n">ayudarte</span><span class="err">?</span>
</code></pre></div>
<p>Чтобы лучше понять, что происходит внутри, ознакомьтесь с этой трассировкой LangSmith.</p>
<h2 id="_7">Управление историей беседы<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h2>
<p>Одна важная концепция, которую необходимо понимать при создании чат-ботов, — это управление историей беседы. Если ею не управлять, список сообщений будет расти неограниченно и потенциально может превысить окно контекста LLM. Поэтому важно добавить шаг, который ограничивает размер передаваемых сообщений.</p>
<p><strong>Важно: вы захотите сделать это ДО шаблона промпта, но ПОСЛЕ загрузки предыдущих сообщений из истории сообщений.</strong></p>
<p>Мы можем сделать это, добавив простой шаг перед промптом, который соответствующим образом изменяет ключ <code>messages</code>, а затем обернуть эту новую цепочку в класс истории сообщений.</p>
<p>LangChain поставляется с несколькими встроенными помощниками для управления списком сообщений. В данном случае мы будем использовать помощник <code>trim_messages</code>, чтобы уменьшить количество сообщений, отправляемых модели. Триммер позволяет нам указать, сколько токенов мы хотим сохранить, а также другие параметры, например, всегда ли сохранять системное сообщение и разрешать ли частичные сообщения:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.messages</span><span class="w"> </span><span class="kn">import</span> <span class="n">SystemMessage</span><span class="p">,</span> <span class="n">trim_messages</span>

<span class="n">trimmer</span> <span class="o">=</span> <span class="n">trim_messages</span><span class="p">(</span>
    <span class="n">max_tokens</span><span class="o">=</span><span class="mi">65</span><span class="p">,</span>
    <span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;last&quot;</span><span class="p">,</span>
    <span class="n">token_counter</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
    <span class="n">include_system</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">allow_partial</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">start_on</span><span class="o">=</span><span class="s2">&quot;human&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">SystemMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;you&#39;re a good assistant&quot;</span><span class="p">),</span>
    <span class="n">HumanMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;hi! I&#39;m bob&quot;</span><span class="p">),</span>
    <span class="n">AIMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;hi!&quot;</span><span class="p">),</span>
    <span class="n">HumanMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;I like vanilla ice cream&quot;</span><span class="p">),</span>
    <span class="n">AIMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;nice&quot;</span><span class="p">),</span>
    <span class="n">HumanMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;whats 2 + 2&quot;</span><span class="p">),</span>
    <span class="n">AIMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;4&quot;</span><span class="p">),</span>
    <span class="n">HumanMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;thanks&quot;</span><span class="p">),</span>
    <span class="n">AIMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;no problem!&quot;</span><span class="p">),</span>
    <span class="n">HumanMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;having fun?&quot;</span><span class="p">),</span>
    <span class="n">AIMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;yes!&quot;</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">trimmer</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">SystemMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;you&#39;re a good assistant&quot;</span><span class="p">,</span> <span class="n">additional_kwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">response_metadata</span><span class="o">=</span><span class="p">{}),</span>
 <span class="n">HumanMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s1">&#39;whats 2 + 2&#39;</span><span class="p">,</span> <span class="n">additional_kwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">response_metadata</span><span class="o">=</span><span class="p">{}),</span>
 <span class="n">AIMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="n">additional_kwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">response_metadata</span><span class="o">=</span><span class="p">{}),</span>
 <span class="n">HumanMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s1">&#39;thanks&#39;</span><span class="p">,</span> <span class="n">additional_kwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">response_metadata</span><span class="o">=</span><span class="p">{}),</span>
 <span class="n">AIMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s1">&#39;no problem!&#39;</span><span class="p">,</span> <span class="n">additional_kwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">response_metadata</span><span class="o">=</span><span class="p">{}),</span>
 <span class="n">HumanMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s1">&#39;having fun?&#39;</span><span class="p">,</span> <span class="n">additional_kwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">response_metadata</span><span class="o">=</span><span class="p">{}),</span>
 <span class="n">AIMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s1">&#39;yes!&#39;</span><span class="p">,</span> <span class="n">additional_kwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">response_metadata</span><span class="o">=</span><span class="p">{})]</span>
</code></pre></div>
<p>Чтобы использовать его в нашей цепочке, нам просто нужно запустить триммер перед передачей входных данных <code>messages</code> нашему промпту.</p>
<div class="highlight"><pre><span></span><code><span class="n">workflow</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">state_schema</span><span class="o">=</span><span class="n">State</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">call_model</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Messages before trimming: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">trimmed_messages</span> <span class="o">=</span> <span class="n">trimmer</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Messages after trimming: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">trimmed_messages</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Remaining messages:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">trimmed_messages</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="n">prompt_template</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">trimmed_messages</span><span class="p">,</span> <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;language&quot;</span><span class="p">]}</span>
    <span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">response</span><span class="p">]}</span>


<span class="n">workflow</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">)</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">call_model</span><span class="p">)</span>

<span class="n">memory</span> <span class="o">=</span> <span class="n">MemorySaver</span><span class="p">()</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">checkpointer</span><span class="o">=</span><span class="n">memory</span><span class="p">)</span>
</code></pre></div>
<p>Теперь, если мы попытаемся спросить у модели наше имя, она его не узнает, поскольку мы обрезали эту часть истории чата. (Определив нашу стратегию обрезки как <code>'last'</code>, мы сохраняем только самые последние сообщения, которые помещаются в <code>max_tokens</code>.)</p>
<div class="highlight"><pre><span></span><code><span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;configurable&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;thread_id&quot;</span><span class="p">:</span> <span class="s2">&quot;abc567&quot;</span><span class="p">}}</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;What is my name?&quot;</span>
<span class="n">language</span> <span class="o">=</span> <span class="s2">&quot;English&quot;</span>

<span class="n">input_messages</span> <span class="o">=</span> <span class="n">messages</span> <span class="o">+</span> <span class="p">[</span><span class="n">HumanMessage</span><span class="p">(</span><span class="n">query</span><span class="p">)]</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">input_messages</span><span class="p">,</span> <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">},</span>
    <span class="n">config</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">output</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">Messages</span> <span class="n">before</span> <span class="n">trimming</span><span class="p">:</span> <span class="mi">12</span>
<span class="n">Messages</span> <span class="n">after</span> <span class="n">trimming</span><span class="p">:</span> <span class="mi">8</span>
<span class="n">Remaining</span> <span class="n">messages</span><span class="p">:</span>
  <span class="n">SystemMessage</span><span class="p">:</span> <span class="n">you</span><span class="s1">&#39;re a good assistant</span>
  <span class="n">HumanMessage</span><span class="p">:</span> <span class="n">whats</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span>
  <span class="n">AIMessage</span><span class="p">:</span> <span class="mi">4</span>
  <span class="n">HumanMessage</span><span class="p">:</span> <span class="n">thanks</span>
  <span class="n">AIMessage</span><span class="p">:</span> <span class="n">no</span> <span class="n">problem</span><span class="err">!</span>
  <span class="n">HumanMessage</span><span class="p">:</span> <span class="n">having</span> <span class="n">fun</span><span class="err">?</span>
  <span class="n">AIMessage</span><span class="p">:</span> <span class="n">yes</span><span class="err">!</span>
  <span class="n">HumanMessage</span><span class="p">:</span> <span class="n">What</span> <span class="ow">is</span> <span class="n">my</span> <span class="n">name</span><span class="err">?</span>
<span class="o">==================================</span><span class="p">[</span><span class="mi">1</span><span class="n">m</span> <span class="n">Ai</span> <span class="n">Message</span> <span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="o">==================================</span>

<span class="n">I</span> <span class="n">don</span><span class="s1">&#39;t know your name. If you&#39;</span><span class="n">d</span> <span class="n">like</span> <span class="n">to</span> <span class="n">share</span> <span class="n">it</span><span class="p">,</span> <span class="n">feel</span> <span class="n">free</span><span class="err">!</span>
</code></pre></div>
<p>Но если мы спросим о информации, которая содержится в последних нескольких сообщениях, она помнит:</p>
<div class="highlight"><pre><span></span><code><span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;configurable&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;thread_id&quot;</span><span class="p">:</span> <span class="s2">&quot;abc678&quot;</span><span class="p">}}</span>

<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;What math problem was asked?&quot;</span>
<span class="n">language</span> <span class="o">=</span> <span class="s2">&quot;English&quot;</span>

<span class="n">input_messages</span> <span class="o">=</span> <span class="n">messages</span> <span class="o">+</span> <span class="p">[</span><span class="n">HumanMessage</span><span class="p">(</span><span class="n">query</span><span class="p">)]</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">input_messages</span><span class="p">,</span> <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">},</span>
    <span class="n">config</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">output</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">Messages</span> <span class="n">before</span> <span class="n">trimming</span><span class="p">:</span> <span class="mi">12</span>
<span class="n">Messages</span> <span class="n">after</span> <span class="n">trimming</span><span class="p">:</span> <span class="mi">8</span>
<span class="n">Remaining</span> <span class="n">messages</span><span class="p">:</span>
  <span class="n">SystemMessage</span><span class="p">:</span> <span class="n">you</span><span class="s1">&#39;re a good assistant</span>
  <span class="n">HumanMessage</span><span class="p">:</span> <span class="n">whats</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span>
  <span class="n">AIMessage</span><span class="p">:</span> <span class="mi">4</span>
  <span class="n">HumanMessage</span><span class="p">:</span> <span class="n">thanks</span>
  <span class="n">AIMessage</span><span class="p">:</span> <span class="n">no</span> <span class="n">problem</span><span class="err">!</span>
  <span class="n">HumanMessage</span><span class="p">:</span> <span class="n">having</span> <span class="n">fun</span><span class="err">?</span>
  <span class="n">AIMessage</span><span class="p">:</span> <span class="n">yes</span><span class="err">!</span>
  <span class="n">HumanMessage</span><span class="p">:</span> <span class="n">What</span> <span class="n">math</span> <span class="n">problem</span> <span class="n">was</span> <span class="n">asked</span><span class="err">?</span>
<span class="o">==================================</span><span class="p">[</span><span class="mi">1</span><span class="n">m</span> <span class="n">Ai</span> <span class="n">Message</span> <span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="o">==================================</span>

<span class="n">The</span> <span class="n">math</span> <span class="n">problem</span> <span class="n">that</span> <span class="n">was</span> <span class="n">asked</span> <span class="n">was</span> <span class="s2">&quot;what&#39;s 2 + 2.&quot;</span>
</code></pre></div>
<p>Если вы посмотрите на LangSmith, вы сможете точно увидеть, что происходит под капотом, в трассировке LangSmith.</p>
<h2 id="_8">Потоковая передача<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<p>Теперь у нас есть работающий чат-бот. Однако одно <em>действительно</em> важное соображение UX для приложений чат-ботов — это потоковая передача. LLM иногда могут отвечать довольно долго, и поэтому, чтобы улучшить пользовательский опыт, большинство приложений передают каждый токен по мере его генерации. Это позволяет пользователю видеть прогресс.</p>
<p>На самом деле это очень просто сделать!</p>
<p>По умолчанию <code>.stream</code> в нашем приложении LangGraph передает шаги приложения — в данном случае единственный шаг ответа модели. Установка <code>stream_mode="messages"</code> позволяет нам передавать выходные токены вместо этого:</p>
<div class="highlight"><pre><span></span><code><span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;configurable&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;thread_id&quot;</span><span class="p">:</span> <span class="s2">&quot;abc789&quot;</span><span class="p">}}</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;Hi I&#39;m Todd, please tell me a joke.&quot;</span>
<span class="n">language</span> <span class="o">=</span> <span class="s2">&quot;English&quot;</span>

<span class="n">input_messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">HumanMessage</span><span class="p">(</span><span class="n">query</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">chunk</span><span class="p">,</span> <span class="n">metadata</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">input_messages</span><span class="p">,</span> <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">},</span>
    <span class="n">config</span><span class="p">,</span>
    <span class="n">stream_mode</span><span class="o">=</span><span class="s2">&quot;messages&quot;</span><span class="p">,</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">AIMessage</span><span class="p">):</span>  <span class="c1"># Фильтр только для ответов модели</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">|</span><span class="n">Hi</span><span class="o">|</span> <span class="n">Todd</span><span class="o">|</span><span class="err">!</span><span class="o">|</span> <span class="n">Here</span><span class="o">|</span><span class="err">’</span><span class="n">s</span><span class="o">|</span> <span class="n">a</span><span class="o">|</span> <span class="n">joke</span><span class="o">|</span> <span class="k">for</span><span class="o">|</span> <span class="n">you</span><span class="o">|</span><span class="p">:</span>
<span class="o">|</span><span class="n">Why</span><span class="o">|</span> <span class="n">don</span><span class="s1">&#39;t| scientists| trust| atoms|?</span>
<span class="o">|</span><span class="n">Because</span><span class="o">|</span> <span class="n">they</span><span class="o">|</span> <span class="n">make</span><span class="o">|</span> <span class="n">up</span><span class="o">|</span> <span class="n">everything</span><span class="o">|</span><span class="err">!</span><span class="o">||</span>
</code></pre></div>
<h2 id="_9">Следующие шаги<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h2>
<p>Теперь, когда вы понимаете основы создания чат-бота в LangChain, вас могут заинтересовать некоторые более продвинутые руководства:</p>
<ul>
<li><a href="https://python.langchain.com/docs/tutorials/rag/">Conversational RAG</a>: Включить опыт чат-бота над внешним источником данных</li>
<li><a href="https://python.langchain.com/docs/tutorials/agents/">Agents</a>: Создать чат-бота, который может выполнять действия</li>
</ul>
<p>Если вы хотите глубже погрузиться в детали, стоит изучить следующее:</p>
<ul>
<li><a href="https://python.langchain.com/docs/how_to/streaming/">Streaming</a>: потоковая передача <em>критически важна</em> для чат-приложений</li>
<li><a href="https://python.langchain.com/docs/how_to/message_history/">How to add message history</a>: для более глубокого погружения во все, что связано с историей сообщений</li>
<li><a href="https://python.langchain.com/docs/how_to/chat_history/">How to manage large message history</a>: дополнительные методы управления большой историей чата</li>
<li><a href="https://langchain-ai.github.io/langgraph/">LangGraph main docs</a>: для получения более подробной информации о создании с помощью LangGraph</li>
</ul>
<p>Source: https://python.langchain.com/docs/tutorials/chatbot/</p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Последнее обновление">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="13 сентября 2025 г. 21:02:22 UTC">13 сентября 2025 г.</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  К началу
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Нижний колонтитул" >
        
          
          <a href="../llm-chain/" class="md-footer__link md-footer__link--prev" aria-label="Назад: Простое приложение LLM">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Назад
              </span>
              <div class="md-ellipsis">
                Простое приложение LLM
              </div>
            </div>
          </a>
        
        
          
          <a href="../agents/" class="md-footer__link md-footer__link--next" aria-label="Вперед: Создайте агента">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Вперед
              </span>
              <div class="md-ellipsis">
                Создайте агента
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://t.me/Aleks3ds" target="_blank" rel="noopener" title="t.me" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M256 8a248 248 0 1 0 0 496 248 248 0 1 0 0-496m115 168.7c-3.7 39.2-19.9 134.4-28.1 178.3-3.5 18.6-10.3 24.8-16.9 25.4-14.4 1.3-25.3-9.5-39.3-18.7-21.8-14.3-34.2-23.2-55.3-37.2-24.5-16.1-8.6-25 5.3-39.5 3.7-3.8 67.1-61.5 68.3-66.7.2-.7.3-3.1-1.2-4.4s-3.6-.8-5.1-.5c-2.2.5-37.1 23.5-104.6 69.1-9.9 6.8-18.9 10.1-26.9 9.9-8.9-.2-25.9-5-38.6-9.1-15.5-5-27.9-7.7-26.8-16.3.6-4.5 6.7-9 18.4-13.7 72.3-31.5 120.5-52.3 144.6-62.3 68.9-28.6 83.2-33.6 92.5-33.8 2.1 0 6.6.5 9.6 2.9 2 1.7 3.2 4.1 3.5 6.7.5 3.2.6 6.5.4 9.8z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.expand", "navigation.top", "navigation.footer", "search.suggest", "search.highlight", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0432 \u0431\u0443\u0444\u0435\u0440", "clipboard.copy": "\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u0443\u0444\u0435\u0440", "search.result.more.one": "\u0415\u0449\u0451 1 \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.more.other": "\u0415\u0449\u0451 # \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.none": "\u0421\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e", "search.result.one": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e 1 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435", "search.result.other": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439: #", "search.result.placeholder": "\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430", "search.result.term.missing": "\u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442", "select.version": "\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0432\u0435\u0440\u0441\u0438\u044e"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="../../assets/js/scheme-toggle.js"></script>
      
        <script src="../../assets/js/custom-footer.js"></script>
      
    
  </body>
</html>